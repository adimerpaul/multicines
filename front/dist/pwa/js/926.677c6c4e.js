"use strict";(globalThis["webpackChunkfront"]=globalThis["webpackChunkfront"]||[]).push([[926],{80926:(e,l,o)=>{o.r(l),o.d(l,{default:()=>oe});var a=o(59835),t=o(86970);const i={class:"row q-col-gutter-sm items-end q-mb-sm"},n={class:"col-12 col-sm-3"},d={class:"col-12 col-sm-3"},s={class:"col-12 col-sm-3"},r={class:"col-12 col-sm-3"},u=(0,a.Uk)("Ver detalle"),c=(0,a.Uk)("Autorizar"),m=(0,a.Uk)("Rechazar"),p=(0,a.Uk)("Anular"),w={class:"text-h6"},h=(0,a._)("b",null,"Fecha:",-1),v=(0,a._)("b",null,"Cajero:",-1),f=(0,a._)("b",null,"Monto:",-1),_=(0,a._)("b",null,"Sección:",-1),b=(0,a._)("b",null,"Motivo:",-1),g=(0,a._)("b",null,"Detalle:",-1),z=(0,a._)("b",null,"Estado:",-1),W=(0,a._)("b",null,"Solicitado por:",-1),k=(0,a._)("b",null,"Autorizado por:",-1),U=(0,a._)("b",null,"Anulado por:",-1),q=(0,a._)("b",null,"Sale ID:",-1),A=(0,a._)("div",{class:"text-h6"},"ANULAR FACTURA",-1);function y(e,l,o,y,C,V){const $=(0,a.up)("q-input"),Z=(0,a.up)("q-select"),Q=(0,a.up)("q-icon"),R=(0,a.up)("q-td"),x=(0,a.up)("q-chip"),D=(0,a.up)("q-item-section"),j=(0,a.up)("q-item-label"),M=(0,a.up)("q-item"),S=(0,a.up)("q-btn"),I=(0,a.up)("q-list"),P=(0,a.up)("q-btn-dropdown"),Y=(0,a.up)("q-table"),F=(0,a.up)("q-space"),O=(0,a.up)("q-card-section"),L=(0,a.up)("q-separator"),T=(0,a.up)("q-card-actions"),E=(0,a.up)("q-card"),N=(0,a.up)("q-dialog"),B=(0,a.up)("q-page"),G=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(B,{class:"q-pa-xs"},{default:(0,a.w5)((()=>[(0,a._)("div",i,[(0,a._)("div",n,[(0,a.Wm)($,{modelValue:C.fi,"onUpdate:modelValue":[l[0]||(l[0]=e=>C.fi=e),V.fetchRows],type:"date",outlined:"",dense:"",label:"Desde"},null,8,["modelValue","onUpdate:modelValue"])]),(0,a._)("div",d,[(0,a.Wm)($,{modelValue:C.ff,"onUpdate:modelValue":[l[1]||(l[1]=e=>C.ff=e),V.fetchRows],type:"date",outlined:"",dense:"",label:"Hasta"},null,8,["modelValue","onUpdate:modelValue"])]),(0,a._)("div",s,[(0,a.Wm)(Z,{dense:"",outlined:"",clearable:"",modelValue:C.estado,"onUpdate:modelValue":[l[2]||(l[2]=e=>C.estado=e),V.fetchRows],options:C.estados,label:"Estado"},null,8,["modelValue","options","onUpdate:modelValue"])]),(0,a._)("div",r,[(0,a.Wm)($,{modelValue:C.filter,"onUpdate:modelValue":l[3]||(l[3]=e=>C.filter=e),outlined:"",dense:"",debounce:"300",label:"Buscar (cajero, motivo, sección, detalle)"},{append:(0,a.w5)((()=>[(0,a.Wm)(Q,{name:"search"})])),_:1},8,["modelValue"])])]),(0,a.Wm)(Y,{title:"Gestionar Anulaciones",flat:"",bordered:"",dense:"","wrap-cells":"",rows:C.rows,columns:C.columns,"row-key":"id","rows-per-page-options":[0],filter:C.filter,separator:"cell"},{"body-cell-fecha":(0,a.w5)((e=>[(0,a.Wm)(R,{props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,t.zw)(e.row.fecha),1)])),_:2},1032,["props"])])),"body-cell-monto":(0,a.w5)((e=>[(0,a.Wm)(R,{props:e,class:"text-right"},{default:(0,a.w5)((()=>{var l;return[(0,a.Uk)((0,t.zw)(Number(null!==(l=e.row.monto)&&void 0!==l?l:0).toFixed(2)),1)]})),_:2},1032,["props"])])),"body-cell-estado":(0,a.w5)((e=>[(0,a.Wm)(R,{props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(x,{dense:"",color:V.chipColor(e.row.estado),"text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,t.zw)(e.row.estado),1)])),_:2},1032,["color"])])),_:2},1032,["props"])])),"body-cell-autorizado_por":(0,a.w5)((e=>[(0,a.Wm)(R,{props:e},{default:(0,a.w5)((()=>{var l,o;return[(0,a.Uk)((0,t.zw)((null===(l=e.row.user_autoriza)||void 0===l?void 0:l.name)||(null===(o=e.row.user_autoriza)||void 0===o?void 0:o.email)||"-"),1)]})),_:2},1032,["props"])])),"body-cell-anulado_por":(0,a.w5)((e=>[(0,a.Wm)(R,{props:e},{default:(0,a.w5)((()=>{var l,o;return[(0,a.Uk)((0,t.zw)((null===(l=e.row.user_anulacion)||void 0===l?void 0:l.name)||(null===(o=e.row.user_anulacion)||void 0===o?void 0:o.email)||"-"),1)]})),_:2},1032,["props"])])),"body-cell-opciones":(0,a.w5)((l=>[(0,a.Wm)(R,{"auto-width":"",props:l},{default:(0,a.w5)((()=>[(0,a.Wm)(P,{color:"primary",label:"Opciones","dropdown-icon":"more_vert","no-caps":"",dense:"",size:"10px"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,null,{default:(0,a.w5)((()=>[(0,a.wy)(((0,a.wg)(),(0,a.j4)(M,{clickable:"",onClick:e=>V.openDetail(l.row)},{default:(0,a.w5)((()=>[(0,a.Wm)(D,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{name:"info"})])),_:1}),(0,a.Wm)(D,null,{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[u])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[G]]),"Pendiente"==l.row.estado&&C.store.boolautorizar?(0,a.wy)(((0,a.wg)(),(0,a.j4)(M,{key:0,clickable:"",onClick:e=>V.onAutorizar(l.row)},{default:(0,a.w5)((()=>[(0,a.Wm)(D,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{name:"check_circle"})])),_:1}),(0,a.Wm)(D,null,{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[c])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[G]]):(0,a.kq)("",!0),"Pendiente"==l.row.estado&&C.store.boolautorizar?(0,a.wy)(((0,a.wg)(),(0,a.j4)(M,{key:1,clickable:"",onClick:e=>V.onRechazar(l.row)},{default:(0,a.w5)((()=>[(0,a.Wm)(D,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{name:"cancel"})])),_:1}),(0,a.Wm)(D,null,{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[m])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[G]]):(0,a.kq)("",!0),"Autorizado"==l.row.estado&&C.store.boolaprobar?(0,a.wy)(((0,a.wg)(),(0,a.j4)(M,{key:2,clickable:"",onClick:e=>V.onAnular(l.row)},{default:(0,a.w5)((()=>[(0,a.Wm)(D,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{name:"delete_forever"})])),_:1}),(0,a.Wm)(D,null,{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[p])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[G]]):(0,a.kq)("",!0),(0,a.wy)(((0,a.wg)(),(0,a.j4)(M,{clickable:""},{default:(0,a.w5)((()=>[(0,a.Wm)(D,null,{default:(0,a.w5)((()=>[(0,a.Wm)(S,{type:"a",color:"primary","no-caps":"",dense:"",class:"full-width",icon:"print",label:"Imprimir Formulario",href:`${e.$api.defaults.baseURL}anulaciones/${l.row.id}/pdf`,target:"_blank"},null,8,["href"])])),_:2},1024)])),_:2},1024)),[[G]])])),_:2},1024)])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","columns","filter"]),(0,a.Wm)(N,{modelValue:C.detailDialog,"onUpdate:modelValue":l[4]||(l[4]=e=>C.detailDialog=e),persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(E,{style:{"min-width":"420px","max-width":"800px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(O,{class:"row items-center q-pb-none"},{default:(0,a.w5)((()=>{var e;return[(0,a._)("div",w,"Detalle de Anulación #"+(0,t.zw)(null===(e=C.selected)||void 0===e?void 0:e.id),1),(0,a.Wm)(F),(0,a.wy)((0,a.Wm)(S,{icon:"close",flat:"",round:"",dense:""},null,512),[[G]])]})),_:1}),(0,a.Wm)(L),(0,a.Wm)(O,{class:"q-gutter-xs"},{default:(0,a.w5)((()=>{var e,l,o,i,n,d,s,r,u,c,m,p,w,A,y,$,Z,Q,R,D,j,M;return[(0,a._)("div",null,[h,(0,a.Uk)(" "+(0,t.zw)(null===(e=C.selected)||void 0===e?void 0:e.fecha),1)]),(0,a._)("div",null,[v,(0,a.Uk)(" "+(0,t.zw)(null===(l=C.selected)||void 0===l?void 0:l.cajero),1)]),(0,a._)("div",null,[f,(0,a.Uk)(" "+(0,t.zw)(Number(null!==(o=null===(i=C.selected)||void 0===i?void 0:i.monto)&&void 0!==o?o:0).toFixed(2)),1)]),(0,a._)("div",null,[_,(0,a.Uk)(" "+(0,t.zw)((null===(n=C.selected)||void 0===n?void 0:n.seccion)||"-"),1)]),(0,a._)("div",null,[b,(0,a.Uk)(" "+(0,t.zw)((null===(d=C.selected)||void 0===d?void 0:d.motivo)||"-"),1)]),(0,a._)("div",null,[g,(0,a.Uk)(" "+(0,t.zw)((null===(s=C.selected)||void 0===s?void 0:s.detalle)||"-"),1)]),(0,a._)("div",null,[z,(0,a.Wm)(x,{dense:"",color:V.chipColor(null===(r=C.selected)||void 0===r?void 0:r.estado),"text-color":"white"},{default:(0,a.w5)((()=>{var e;return[(0,a.Uk)((0,t.zw)(null===(e=C.selected)||void 0===e?void 0:e.estado),1)]})),_:1},8,["color"])]),(0,a._)("div",null,[W,(0,a.Uk)(" "+(0,t.zw)((null===(u=C.selected)||void 0===u||null===(c=u.user)||void 0===c?void 0:c.name)||(null===(m=C.selected)||void 0===m||null===(p=m.user)||void 0===p?void 0:p.email)||(null===(w=C.selected)||void 0===w?void 0:w.user_id)),1)]),(0,a._)("div",null,[k,(0,a.Uk)(" "+(0,t.zw)((null===(A=C.selected)||void 0===A||null===(y=A.user_autoriza)||void 0===y?void 0:y.name)||(null===($=C.selected)||void 0===$||null===(Z=$.user_autoriza)||void 0===Z?void 0:Z.email)||"-"),1)]),(0,a._)("div",null,[U,(0,a.Uk)(" "+(0,t.zw)((null===(Q=C.selected)||void 0===Q||null===(R=Q.user_anulacion)||void 0===R?void 0:R.name)||(null===(D=C.selected)||void 0===D||null===(j=D.user_anulacion)||void 0===j?void 0:j.email)||"-"),1)]),(0,a._)("div",null,[q,(0,a.Uk)(" "+(0,t.zw)((null===(M=C.selected)||void 0===M?void 0:M.sale_id)||"-"),1)])]})),_:1}),(0,a.Wm)(T,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(S,{flat:"",label:"Cerrar",dense:""},null,512),[[G]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(N,{modelValue:C.dialogAnular,"onUpdate:modelValue":l[6]||(l[6]=e=>C.dialogAnular=e)},{default:(0,a.w5)((()=>[(0,a.Wm)(E,{style:{"min-width":"350px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[A])),_:1}),(0,a.Wm)(O,{class:"q-pt-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{label:"motivo",options:C.motivos,modelValue:C.motivo,"onUpdate:modelValue":l[5]||(l[5]=e=>C.motivo=e)},null,8,["options","modelValue"])])),_:1}),(0,a.Wm)(T,{align:"right",class:"text-primary"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(S,{flat:"",label:"Cancel",loading:C.loading},null,8,["loading"]),[[G]]),(0,a.Wm)(S,{flat:"",label:"ANULAR",onClick:V.enviarAnular,loading:C.loading},null,8,["onClick","loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}o(24110);var C=o(43878),V=o.n(C),$=o(73285);const Z={name:"AnulacionesPage",data(){return{store:(0,$.c)(),rows:[],filter:"",estados:["Pendiente","Autorizado","Anulado","Rechazado"],estado:null,fi:V()().startOf("month").format("YYYY-MM-DD"),ff:V()().endOf("month").format("YYYY-MM-DD"),detailDialog:!1,selected:null,authUser:null,columns:[{name:"opciones",label:"Opciones",field:"opciones"},{name:"id",label:"#",field:"id",sortable:!0},{name:"fecha",label:"Fecha",field:"fecha",sortable:!0},{name:"cajero",label:"Cajero",field:"cajero",sortable:!0},{name:"monto",label:"Monto",field:"monto",sortable:!0,align:"right"},{name:"seccion",label:"Sección",field:"seccion",sortable:!0},{name:"motivo",label:"Motivo",field:"motivo",sortable:!0},{name:"detalle",label:"Detalle",field:"detalle",sortable:!0},{name:"estado",label:"Estado",field:"estado",sortable:!0},{name:"autorizado_por",label:"Autorizado por",field:e=>{var l,o;return(null===(l=e.user_autoriza)||void 0===l?void 0:l.name)||(null===(o=e.user_autoriza)||void 0===o?void 0:o.email)||"-"},sortable:!0},{name:"anulado_por",label:"Anulado por",field:e=>{var l,o;return(null===(l=e.user_anulacion)||void 0===l?void 0:l.name)||(null===(o=e.user_anulacion)||void 0===o?void 0:o.email)||"-"},sortable:!0}],motivos:[],motivo:null,dialogAnular:!1,loading:!1}},created(){this.$api.get("user").then((e=>{this.authUser=e.data})).catch((()=>this.authUser={id:0})),this.fetchRows(),this.cargarMotivo()},methods:{enviarAnular(){this.loading=!0,this.$api.post("anularSale",{sale:this.factura,motivo:this.motivo}).then((e=>{this.fetchRows(),this.dialogAnular=!1,this.loading=!1,this.$q.notify({message:"Factura anulada",color:"positive",icon:"done"})}))},cargarMotivo(){this.$api.get("motivoanular").then((e=>{e.data.forEach((e=>{e.label=e.descripcion})),this.motivos=e.data,this.motivo=this.motivos[0]}))},chipColor(e){switch(e){case"Pendiente":return"orange-7";case"Autorizado":return"primary";case"Anulado":return"positive";case"Rechazado":return"negative";default:return"grey-7"}},fetchRows(){const e={per_page:0};this.estado&&(e.estado=this.estado),this.fi&&(e.fi=this.fi),this.ff&&(e.ff=this.ff),this.$q.loading.show(),this.$api.get("anulaciones",{params:e}).then((e=>{this.rows=e.data})).finally((()=>this.$q.loading.hide()))},openDetail(e){this.selected=e,this.detailDialog=!0},canAutorizar(e){return!!this.authUser&&("Pendiente"===e.estado&&e.user_id!==this.authUser.id)},canAnular(e){return!!this.authUser&&("Autorizado"===e.estado&&e.user_autoriza_id!==this.authUser.id)},onAutorizar(e){this.$q.dialog({title:"Autorizar anulación",message:"¿Confirmas autorizar esta solicitud?",prompt:{model:"",type:"text",label:"Motivo (opcional)"},cancel:!0,persistent:!0}).onOk((l=>{this.$q.loading.show(),this.$api.post(`anulaciones/${e.id}/autorizar`,{motivo:l}).then((e=>this.replaceRow(e.data))).finally((()=>this.$q.loading.hide()))}))},onRechazar(e){this.$q.dialog({title:"Rechazar anulación",message:"¿Confirmas rechazar esta solicitud?",prompt:{model:"",type:"text",label:"Motivo del rechazo (opcional)"},cancel:!0,persistent:!0}).onOk((l=>{this.$q.loading.show(),this.$api.post(`anulaciones/${e.id}/rechazar`,{motivo:l}).then((e=>this.replaceRow(e.data))).finally((()=>this.$q.loading.hide()))}))},onAnular(e){this.factura=e.sale,this.dialogAnular=!0},replaceRow(e){const l=this.rows.findIndex((l=>l.id===e.id));l>=0&&(this.$set?this.$set(this.rows,l,e):this.rows.splice(l,1,e)),this.$q.notify({message:"Actualizado",color:"positive",icon:"done"})}}};var Q=o(11639),R=o(69885),x=o(13119),D=o(26384),j=o(22857),M=o(74356),S=o(67220),I=o(57691),P=o(32045),Y=o(13246),F=o(490),O=o(76749),L=o(33115),T=o(68879),E=o(32074),N=o(44458),B=o(63190),G=o(90136),H=o(50926),J=o(11821),K=o(62146),X=o(69984),ee=o.n(X);const le=(0,Q.Z)(Z,[["render",y]]),oe=le;ee()(Z,"components",{QPage:R.Z,QInput:x.Z,QSelect:D.Z,QIcon:j.Z,QTable:M.Z,QTd:S.Z,QChip:I.Z,QBtnDropdown:P.Z,QList:Y.Z,QItem:F.Z,QItemSection:O.Z,QItemLabel:L.Z,QBtn:T.Z,QDialog:E.Z,QCard:N.Z,QCardSection:B.Z,QSpace:G.Z,QSeparator:H.Z,QCardActions:J.Z}),ee()(Z,"directives",{ClosePopup:K.Z})}}]);